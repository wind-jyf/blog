# 浏览器之HTTP协议

> HTTP协议，是建立在TCP连接基础之上。HTTP是一种允许浏览器向服务器获取资源的协议，是Web的基础，HTTP协议也是浏览器使用最广的协议

#### 一、浏览器端发起HTTP请求流程

如果在浏览器中输入一行网址，浏览器会完成哪些动作呢？

##### 1.构建请求

首先，浏览器构建请求行信息，构建好后，浏览器准备发起请求

##### 2.查找缓存

> 浏览器缓存是一种在本地保存资源的副本，以供下次请求时直接使用的技术

1. 在真正发起网络请求之前，浏览器会在浏览器缓存中查询是否有要请求的文件
2. 当浏览器发现请求的资源已经在浏览器缓存中存有副本，它会拦截请求，返回该资源的副本，并直接结束请求
3. 如果缓存查找失败，就会进入网络请求过程

##### 3.准备IP地址和端口

> HTTP是应用层协议，用来封装请求的文本信息；使用TCP/IP作为传输层的协议，在浏览器工作开始之前，浏览器需要通过TCP与服务器建立连接，所以HTTP内容是通过TCP传输数据阶段实现的

![15](E:\1-github博客\blog\images\15.png)

我们在建立TCP连接时，需要获得IP一级端口号，此时该如何获取呢？

由于IP地址是数字标识，比较难记，所以基于这个需求又出现了一个服务，负责把域名和IP地址做一一映射关系，这套域名映射为IP的系统就叫做**“域名系统”**，简称DNS。

1. 浏览器第一步会先请求DNS返回IP
2. 当然也有DNS数据缓存服务
3. 如果URL没有特别指明端口号，则默认为80端口



##### 4.等待TCP队列

Chrome有个机制，同一域名同时最多只能建立6个TCP连接，如果在同一域名下同时有10个请求发生，那么其中4个进入排队等待状态，直至进行中的请求完。



##### 5.建立TCP连接

##### 6.发送HTTP请求

![16](E:\1-github博客\blog\images\16.png)

1. 浏览器会向服务器发送请求行，它包括请求方法，请求URI和HTTP协议版本
2. 在浏览器发送请求行命令后，还要以请求头形式发送其他信息，例如浏览器所使用的操作系统、cookie信息等等
3. POST请求发送数据到服务器时，数据以请求体发送

#### 二、服务器处理HTTP请求流程

##### 1.返回请求

![17](E:\1-github博客\blog\images\17.png)

##### 2.断开连接

 通常情况下，一旦服务器向客户端返回了请求数据，它就要关闭 TCP 连接。不过如果浏览器或者服务器在其头信息中加入了： 

```
Connection:Keep-Alive
```

 那么 TCP 连接在发送后将仍然保持打开状态，这样浏览器就可以继续通过同一个 TCP 连接发送请求。**保持 TCP 连接可以省去下次请求时需要建立连接的时间，提升资源加载速度** 。



##### 3.重定向

例如在浏览器中打开geekbang.org后，会发现最终打开的网址是http://www.geekbang.org

![18](E:\1-github博客\blog\images\18.png)

1. 相应行返回的状态码是301，便是告诉浏览器，要进行重定向
2. 重定向的网址便在Location字段中
3. 浏览器获得新地址，重新导航
4. 不过重定向也不是必然的



#### 三、为什么很多站点第二次打开速度回很快



![19](E:\1-github博客\blog\images\19.png)

1. 浏览器通过响应头的Cache-Control字段来设置是否缓存该资源
2. DNS缓存和页面资源缓存这两块数据会被浏览器缓存的



![20](E:\1-github博客\blog\images\20.png)



#### 四、参考

***

* 极客时间 浏览器工作原理与实战

